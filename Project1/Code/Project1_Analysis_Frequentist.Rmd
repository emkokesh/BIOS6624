---
title: "Project1_Analysis_Frequentist"
output: html_document
---


Section 1: Load data

```{r}
library(broom)
library(dplyr)
library(tidyr)
library(stringr)
library(knitr)
library(kableExtra)

data <- read.csv("C:/Users/kokeshem/Spring 2026/Advanced Data Analysis/BIOS6624/Project1/DataProcessed/project1_clean.csv")
data

# make sure categorical vars are factors
df_a <- data %>%
  mutate(
    hard_drugs_bl = factor(hard_drugs_bl),
    race_cat      = factor(race_cat),
    educ_cat      = factor(educ_cat),
    smoke_cat     = factor(smoke_cat),
    adh_cat       = factor(adh_cat)
  ) %>%
  select(
    newid, years,
    hard_drugs_bl, adh_cat,
    vload, leu3n, agg_phys, agg_ment,
    age, bmi, race_cat, educ_cat, smoke_cat
  )

#confirm we have year 0 and year 2
print(df_a %>% count(years))

#create baseline (Year 0) outcome covariates and merge onto Year 2
#transform baseline and year 2 vload

baseline_y0 <- df_a %>%
  filter(years == 0) %>%
  select(
    newid,
    vload, leu3n, agg_phys, agg_ment,
    age, bmi, race_cat, educ_cat, smoke_cat
  ) %>%
  rename(
    vload_bl     = vload,
    leu3n_bl     = leu3n,
    agg_phys_bl  = agg_phys,
    agg_ment_bl  = agg_ment,
    age_bl       = age,
    bmi_bl       = bmi,
    race_cat_bl  = race_cat,
    educ_cat_bl  = educ_cat,
    smoke_cat_bl = smoke_cat
  ) %>%
  mutate(
    log10_vload_bl = ifelse(!is.na(vload_bl) & vload_bl > 0, log10(vload_bl), NA_real_)
  )

#check there is one row per person at baseline
print(baseline_y0 %>% summarise(n_rows = n(), n_ids = n_distinct(newid)))

#build year 2 dataset
df_y2 <- df_a %>%
  filter(years == 2) %>%
  select(
    newid,
    hard_drugs_bl, adh_cat,
    vload, leu3n, agg_phys, agg_ment
  ) %>%
  left_join(baseline_y0, by = "newid") %>%
  mutate(
    log10_vload = ifelse(!is.na(vload) & vload > 0, log10(vload), NA_real_)
  )

#check there is one row per person at year 2
print(df_y2 %>% summarise(n_rows = n(), n_ids = n_distinct(newid)))

#check that merge was done correctly and no missing data
print(df_y2 %>% summarise(
  missing_baseline_vload = sum(is.na(vload_bl)),
  missing_baseline_log10 = sum(is.na(log10_vload_bl)),
  missing_age_bl         = sum(is.na(age_bl)),
  missing_bmi_bl         = sum(is.na(bmi_bl)),
  missing_race_bl        = sum(is.na(race_cat_bl)),
  missing_educ_bl        = sum(is.na(educ_cat_bl)),
  missing_smoke_bl       = sum(is.na(smoke_cat_bl))
))

#check first 10 rows
print(df_y2 %>%
  select(newid, vload, log10_vload, vload_bl, log10_vload_bl,
         age_bl, bmi_bl, race_cat_bl, educ_cat_bl, smoke_cat_bl) %>%
  slice_head(n = 10)
)
```
Section 2: Linear Regression Models
```{r}
#models 

#Viral load
m_vload_adh <- lm(
  log10_vload ~ hard_drugs_bl + log10_vload_bl + adh_cat +
    age_bl + bmi_bl + race_cat_bl + educ_cat_bl + smoke_cat_bl,
  data = df_y2
)
m_vload_noadh <- update(m_vload_adh, . ~ . - adh_cat)

summary(m_vload_adh)
summary(m_vload_noadh)

#CD4 
m_leu3n_adh <- lm(
  leu3n ~ hard_drugs_bl + leu3n_bl + adh_cat +
    age_bl + bmi_bl + race_cat_bl + educ_cat_bl + smoke_cat_bl,
  data = df_y2
)
m_leu3n_noadh <- update(m_leu3n_adh, . ~ . - adh_cat)

summary(m_leu3n_adh)
summary(m_leu3n_noadh)

#Physical QOL
m_phys_adh <- lm(
  agg_phys ~ hard_drugs_bl + agg_phys_bl + adh_cat +
    age_bl + bmi_bl + race_cat_bl + educ_cat_bl + smoke_cat_bl,
  data = df_y2
)
m_phys_noadh <- update(m_phys_adh, . ~ . - adh_cat)

summary(m_phys_adh)
summary(m_phys_noadh)

#Mental QOL
m_ment_adh <- lm(
  agg_ment ~ hard_drugs_bl + agg_ment_bl + adh_cat +
    age_bl + bmi_bl + race_cat_bl + educ_cat_bl + smoke_cat_bl,
  data = df_y2
)
m_ment_noadh <- update(m_ment_adh, . ~ . - adh_cat)

summary(m_ment_adh)
summary(m_ment_noadh)



```
Section 3: Extract Key Results, Create tables














































