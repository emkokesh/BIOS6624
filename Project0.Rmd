---
title: "Cortisol"
author: "Emily Kokesh"
date: "2026-01-26"
output: html_document
documentclass: article
geometry: margin=1in
fontsize: 12pt
linestretch: 2
fig.cap: true
---
## Data loading and cleaning, missingness analysis
```{r}
# load libraries
library(tidyverse)
library(lme4)
library(lmerTest)
library(lubridate)
library(knitr)
library(broom.mixed)
library(kableExtra)


# load data
path <- "C:/Users/kokeshem/Spring 2026/Advanced Statistical Methods/Project0_Clean_v2.csv"
df <- read.csv(path, na.strings = c("", "NA"))

# data cleaning, renaming, trimming

df <- df %>% 
  rename(
    Booklet_Clock_Time = Booket..Clock.Time, 
    MEMs_Clock_Time = MEMs..Clock.Time,
    Wake_Time = Sleep.Diary.reported.wake.time,
    Cortisol_nmol = Cortisol..nmol.L.,
    DHEA_nmol = DHEA..nmol.L.
  ) %>%
  #remove unnecessary columns for analysis
  select(
    SubjectID, 
    Collection.Date, 
    Collection.Sample, 
    DAYNUMB,
    Booklet_Clock_Time, 
    MEMs_Clock_Time, 
    Wake_Time, 
    Cortisol_nmol, 
    DHEA_nmol
  )

#fill wake time so each sample per day has the same wake time
df <- df %>%
  group_by(SubjectID, Collection.Date) %>%
  fill(Wake_Time, .direction = "downup") %>%
  ungroup()

#helper function
to_mins <- function(time_str) {
  t <- hm(time_str, quiet = TRUE)
  return(as.numeric(t) / 60)
}

#calculate minutes since waking
df <- df %>%
  mutate(
    Wake_Min = to_mins(Wake_Time),
    Booklet_Clock_Min = to_mins(Booklet_Clock_Time),
    MEMs_Clock_Min = to_mins(MEMs_Clock_Time),
    
    #final analysis variables
    Booklet_Min_Since_Wake = Booklet_Clock_Min - Wake_Min,
    MEMs_Min_Since_Wake = MEMs_Clock_Min - Wake_Min
  )

#check simplified structure
str(df)
view(df)

#create missing data frame
missing_table <- data.frame(
  variable = c("mems cap time", "booklet time", "cortisol level", "dhea level"),
  missing_count = c(
    sum(is.na(df$MEMs_Clock_Time)),
    sum(is.na(df$Booklet_Clock_Time)),
    sum(is.na(df$Cortisol_nmol)),
    sum(is.na(df$DHEA_nmol))
  ),
  percentage = c(
    mean(is.na(df$MEMs_Clock_Time)) * 100,
    mean(is.na(df$Booklet_Clock_Time)) * 100,
    mean(is.na(df$Cortisol_nmol)) * 100,
    mean(is.na(df$DHEA_nmol)) * 100
  )
)

#fromat and print missingness table
missing_table %>%
  kable(
    col.names = c("variable", "missing count (n)", "percentage (%)"),
    digits = 1,
    caption = "summary of missing data across primary study variables"
  )

```

## Question 1: Agreement Analysis
```{r}
#filter data complete pairs of Booklet and MEM times
df_q1 <- df %>%
  filter(!is.na(Booklet_Min_Since_Wake) & !is.na(MEMs_Min_Since_Wake)) %>%
  mutate(bias = Booklet_Min_Since_Wake - MEMs_Min_Since_Wake)
#check df_q1
view(df_q1)

#calculate correlation
correlation_result <- cor(df_q1$Booklet_Min_Since_Wake, df_q1$MEMs_Min_Since_Wake)
print(paste("correlation between booklet and cap:", round(correlation_result, 4)))

#calculate bias summary
bias_summary <- summary(df_q1$bias)
print("summary statistics for bias:")
print(bias_summary)

#make presentation theme
presentation_theme <- theme_minimal(base_size = 18) +
  theme(
    plot.title = element_text(size = 22, face = "bold", hjust = 0.5),
    axis.title = element_text(size = 20, face = "bold"),
    axis.text = element_text(size = 16),
    legend.title = element_text(size = 18),
    legend.text = element_text(size = 16),
    panel.grid.major = element_line(color = "grey90"),
    panel.grid.minor = element_blank()
  )

#visualize bias distribution
#increased binwidth and clearer labels for the histogram
ggplot(df_q1, aes(x = bias)) +
  geom_histogram(binwidth = 2, fill = "steelblue", color = "white") +
  presentation_theme +
  labs(
    title = "Distribution of Time Differences",
    x = "Bias (booklet - cap minutes)",
    y = "Number of Samples"
  )

# prepare the correlation label
cor_label <- paste0("Correlation: ", round(correlation_result, 3))

# visualize agreement scatterplot
ggplot(df_q1) +
  geom_point(aes(x = MEMs_Min_Since_Wake, y = Booklet_Min_Since_Wake, color = "Observed Samples"), 
             alpha = 0.4, size = 3) +
  geom_abline(aes(intercept = 0, slope = 1, color = "Perfect Agreement Line"), 
              linetype = "dashed", linewidth = 1.2) +
  annotate("text", x = 400, y = 50, label = cor_label, 
           size = 5, fontface = "italic", color = "grey30") +
  scale_color_manual(name = NULL, 
                     values = c("Observed Samples" = "darkblue", "Perfect Agreement Line" = "red")) +
  presentation_theme +
  theme(
    legend.position = "bottom",
    legend.direction = "horizontal",
    legend.box = "horizontal",
    legend.key = element_blank()
  ) +
  labs(
    title = "Agreement Between Booklet and Cap Clocks",
    x = "Cap Minutes Since Wake",
    y = "Booklet Minutes Since Wake"
  )


#linear mixed model: random intercept only
# this accounts for the fact that each subject has a different baseline bias
model_intercept <- lmer(Booklet_Min_Since_Wake ~ MEMs_Min_Since_Wake + 
                          (1 | SubjectID), 
                        data = df_q1)
summary(model_intercept)


#linear mixed model: random intercept and slope
#predictor is centered to help convergence
df_q1 <- df_q1 %>%
  mutate(MEMs_centered = MEMs_Min_Since_Wake - mean(MEMs_Min_Since_Wake, na.rm = TRUE))

agreement_model_final <- lmer(Booklet_Min_Since_Wake ~ MEMs_centered + 
                                (1 + MEMs_centered | SubjectID), 
                              data = df_q1,
                              control = lmerControl(optimizer = "nlminbwrap",
                                                   optCtrl = list(maxfun = 1e5)))
                              
summary(agreement_model_final)

#compare to see if the random slope improves fit
anova(model_intercept, agreement_model_final)

#question 1 results table
q1_model_table <- tidy(model_intercept, effects = "fixed", conf.int = TRUE) %>%
  mutate(
    term = case_when(
      term == "(Intercept)" ~ "Intercept (Booklet mins when Cap = 0)",
      term == "MEMs_Min_Since_Wake" ~ "Agreement Slope (Booklet vs Cap)",
      TRUE ~ term
    ),
    estimate = round(estimate, 3),
    std.error = round(std.error, 3),
    conf_interval = paste0("[", round(conf.low, 3), ", ", round(conf.high, 3), "]"),
    p_value = ifelse(p.value < 0.001, "< 0.001", round(p.value, 3))
  ) %>%
  select(term, estimate, std.error, conf_interval, p_value)

q1_model_table %>%
  kable(
    col.names = c("Parameter", "Estimate", "Std error", "95% CI", "p-value"),
    caption = "Table Q1: Linear mixed model for booklet vs cap minutes since waking (random intercept by subject)",
    align = "llccc"
  )


#table 1: study overview, missingness, and booklet vs cap bias

table1_compact <- df %>%
  mutate(
    pair_available = !is.na(Booklet_Min_Since_Wake) & !is.na(MEMs_Min_Since_Wake),
    bias_pair = ifelse(pair_available, Booklet_Min_Since_Wake - MEMs_Min_Since_Wake, NA)
  ) %>%
  group_by(Collection.Sample) %>%
  summarise(
    n_total = n(),
    n_pairs = sum(pair_available),

    miss_cap = sum(is.na(MEMs_Clock_Time)),
    miss_booklet = sum(is.na(Booklet_Clock_Time)),
    miss_cort = sum(is.na(Cortisol_nmol)),
    miss_dhea = sum(is.na(DHEA_nmol)),

    mean_cort = mean(Cortisol_nmol, na.rm = TRUE),
    sd_cort = sd(Cortisol_nmol, na.rm = TRUE),
    mean_dhea = mean(DHEA_nmol, na.rm = TRUE),
    sd_dhea = sd(DHEA_nmol, na.rm = TRUE),

    mean_bias = mean(bias_pair, na.rm = TRUE),
    sd_bias = sd(bias_pair, na.rm = TRUE),

    .groups = "drop"
  ) %>%
  mutate(
    collection_point = case_when(
      Collection.Sample == 1 ~ "Waking (S1)",
      Collection.Sample == 2 ~ "+30 min (S2)",
      Collection.Sample == 3 ~ "Lunch (S3)",
      Collection.Sample == 4 ~ "+10 hr (S4)"
    ),

    paired_pct = 100 * n_pairs / n_total,

    miss_cap_fmt = paste0(miss_cap, " (", round(100 * miss_cap / n_total, 1), "%)"),
    miss_booklet_fmt = paste0(miss_booklet, " (", round(100 * miss_booklet / n_total, 1), "%)"),
    miss_cort_fmt = paste0(miss_cort, " (", round(100 * miss_cort / n_total, 1), "%)"),
    miss_dhea_fmt = paste0(miss_dhea, " (", round(100 * miss_dhea / n_total, 1), "%)"),

    cortisol_fmt = paste0(round(mean_cort, 2), " (", round(sd_cort, 2), ")"),
    dhea_fmt = paste0(round(mean_dhea, 2), " (", round(sd_dhea, 2), ")"),

    bias_ci = paste0(
      round(mean_bias, 2), " [",
      round(mean_bias - 1.96 * (sd_bias / sqrt(n_pairs)), 2), ", ",
      round(mean_bias + 1.96 * (sd_bias / sqrt(n_pairs)), 2), "]"
    )
  ) %>%
  select(
    collection_point,
    n_total,
    n_pairs,
    paired_pct,
    miss_cap_fmt,
    miss_booklet_fmt,
    miss_cort_fmt,
    miss_dhea_fmt,
    cortisol_fmt,
    dhea_fmt,
    bias_ci
  )

#study-wide total row
study_totals <- df %>%
  mutate(
    pair_available = !is.na(Booklet_Min_Since_Wake) & !is.na(MEMs_Min_Since_Wake),
    bias_pair = ifelse(pair_available, Booklet_Min_Since_Wake - MEMs_Min_Since_Wake, NA)
  ) %>%
  summarise(
    collection_point = "Study-wide total",
    n_total = n(),
    n_pairs = sum(pair_available),
    paired_pct = 100 * n_pairs / n_total,

    miss_cap_fmt = paste0(sum(is.na(MEMs_Clock_Time)), " (", round(100 * mean(is.na(MEMs_Clock_Time)), 1), "%)"),
    miss_booklet_fmt = paste0(sum(is.na(Booklet_Clock_Time)), " (", round(100 * mean(is.na(Booklet_Clock_Time)), 1), "%)"),
    miss_cort_fmt = paste0(sum(is.na(Cortisol_nmol)), " (", round(100 * mean(is.na(Cortisol_nmol)), 1), "%)"),
    miss_dhea_fmt = paste0(sum(is.na(DHEA_nmol)), " (", round(100 * mean(is.na(DHEA_nmol)), 1), "%)"),

    cortisol_fmt = paste0(round(mean(Cortisol_nmol, na.rm = TRUE), 2), " (", round(sd(Cortisol_nmol, na.rm = TRUE), 2), ")"),
    dhea_fmt = paste0(round(mean(DHEA_nmol, na.rm = TRUE), 2), " (", round(sd(DHEA_nmol, na.rm = TRUE), 2), ")"),

    bias_ci = {
      mb <- mean(bias_pair, na.rm = TRUE)
      sb <- sd(bias_pair, na.rm = TRUE)
      np <- sum(pair_available)
      paste0(round(mb, 2), " [", round(mb - 1.96 * (sb / sqrt(np)), 2), ", ", round(mb + 1.96 * (sb / sqrt(np)), 2), "]")
    }
  )

#bind and print
bind_rows(table1_compact, study_totals) %>%
  kable(
    col.names = c(
      "Collection point",
      "N samples",
      "N paired times",
      "% paired",
      "Missing cap time n (%)",
      "Missing booklet time n (%)",
      "Missing cortisol nmol/L n (%)",
      "Missing DHEA nmol/L n (%)",
      "Cortisol nmol/L mean (SD)",
      "DHEA nmol/L mean (SD)",
      "Mean bias (booklet-cap), min [95% CI]"
    ),
    caption = "Table 1: Study overview, missingness, and booklet vs cap timing bias (minutes since wake)",
    align = "lcccccccccc"
  ) %>%
  kable_styling(full_width = FALSE, font_size = 12) %>%
  column_spec(1, width = "1.2in") %>%
  column_spec(2, width = "0.7in") %>%
  column_spec(3, width = "0.9in") %>%
  column_spec(4, width = "0.7in") %>%
  column_spec(5, width = "1.1in") %>%
  column_spec(6, width = "1.2in") %>%
  column_spec(7, width = "1.2in") %>%
  column_spec(8, width = "1.2in") %>%
  column_spec(9, width = "1.1in") %>%
  column_spec(10, width = "1.1in") %>%
  column_spec(11, width = "1.7in")




```
## Question 2: Adherence Analysis

```{r}
#make new column with target time, calculate difference between actual (MEM) time and target time
df_q2 <- df %>%
  filter(Collection.Sample %in% c(2, 4)) %>%
  mutate(
    Target = ifelse(Collection.Sample == 2, 30, 600),
    Time_Diff = MEMs_Min_Since_Wake - Target,
    Abs_Diff = abs(Time_Diff)
  )

#create adherence categories (within 7.5 or 15 minutes)
df_q2 <- df_q2 %>%
  mutate(
    In_7.5_Window = !is.na(Time_Diff) & Abs_Diff <= 7.5,
    In_15_Window = !is.na(Time_Diff) & Abs_Diff <= 15
  )

#proportion of adherence table
adherence_proportions <- df_q2 %>%
  group_by(Collection.Sample) %>%
  summarise(
    `Scheduled Sample` = ifelse(first(Collection.Sample) == 2, "30-Min Target (S2)", "10-Hour Target (S4)"),
    `Expected (N)` = n(),
    `MEMs Recorded (N)` = sum(!is.na(Time_Diff)),
    `Missing MEMs (N, %)` = paste0(
      sum(is.na(Time_Diff)), " (",
      round(100 * sum(is.na(Time_Diff)) / n(), 1), "%)"
    ),
    `Within 7.5 Min (N, %)` = {
      n_obs <- sum(!is.na(Time_Diff))
      n_in <- sum(In_7.5_Window, na.rm = TRUE)
      paste0(n_in, " (", round(100 * n_in / n_obs, 1), "%)")
    },
    `Within 15 Min (N, %)` = {
      n_obs <- sum(!is.na(Time_Diff))
      n_in <- sum(In_15_Window, na.rm = TRUE)
      paste0(n_in, " (", round(100 * n_in / n_obs, 1), "%)")
    }
  ) %>%
  select(
    `Scheduled Sample`,
    `Expected (N)`,
    `MEMs Recorded (N)`,
    `Missing MEMs (N, %)`,
    `Within 7.5 Min (N, %)`,
    `Within 15 Min (N, %)`
  )

kable(
  adherence_proportions,
  align = "lccccc",
  caption = "Protocol Adherence Using MEMs Times (Denominator = Samples With MEMs Time Recorded)"
)

#descriptive statistics table
timing_descriptives <- df_q2 %>%
  filter(!is.na(Time_Diff)) %>%
  group_by(Collection.Sample) %>%
  summarise(
    `Scheduled Sample` = ifelse(first(Collection.Sample) == 2, "30-Min Target (S2)", "10-Hour Target (S4)"),
    `N` = n(),
    `Mean (SD)` = paste0(round(mean(Time_Diff), 1), " (", round(sd(Time_Diff), 1), ")"),
    `Median (Q1, Q3)` = paste0(
      round(median(Time_Diff), 1), " (",
      round(quantile(Time_Diff, 0.25), 1), ", ",
      round(quantile(Time_Diff, 0.75), 1), ")"
    ),
    `Min, Max` = paste0(round(min(Time_Diff), 0), ", ", round(max(Time_Diff), 0)),
    `Early (N, %)` = {
      n_tot <- n()
      n_early <- sum(Time_Diff < 0)
      paste0(n_early, " (", round(100 * n_early / n_tot, 1), "%)")
    },
    `Late (N, %)` = {
      n_tot <- n()
      n_late <- sum(Time_Diff > 0)
      paste0(n_late, " (", round(100 * n_late / n_tot, 1), "%)")
    }
  ) %>%
  select(
    `Scheduled Sample`,
    `N`,
    `Mean (SD)`,
    `Median (Q1, Q3)`,
    `Min, Max`,
    `Early (N, %)`,
    `Late (N, %)`
  )

kable(
  timing_descriptives,
  align = "lcccccc",
  caption = "Timing Deviations Using MEMs Times (MEMs Time - Target, Minutes)"
)

#visualize the spread of timing deviations
ggplot(df_q2, aes(x = factor(Collection.Sample), y = Time_Diff, fill = factor(Collection.Sample))) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black", linewidth = 1) +
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = -15, ymax = 15, alpha = .1, fill = "green") +
  geom_boxplot(width = 0.5, outlier.color = "red", alpha = 0.7) +
  scale_x_discrete(labels = c("2" = "30-Min Target", "4" = "10-Hour Target")) +
  scale_fill_manual(values = c("steelblue", "darkblue")) +
  presentation_theme +
  theme(
    legend.position = "none",
    axis.title.x = element_text(size = 14, face = "bold"),
    axis.title.y = element_text(size = 14, face = "bold")
  ) +
  labs(
    title = "Distribution of Protocol Deviations",
    subtitle = "Green shaded area represents the Â±15 min window",
    x = "Scheduled Sample",
    y = "Minutes Off-Target (Actual - Target)"
  )

```




## Question 3: Changes in DHEA and Cortisol throughout the day
```{r}

#identify values over 80 nmol
cort_outliers <- df %>%
  filter(Cortisol_nmol > 80)

#identify missing values
cort_missing <- df %>%
  filter(is.na(Cortisol_nmol))

#create cleaned cortisol dataframe by excluding values over 80 nmol/L as per investigator instructions
df_cort_clean <- df %>%
  filter(!is.na(Cortisol_nmol)) %>%
  filter(Cortisol_nmol <= 80)

#find subjects with multiple measures at detection limit
dhea_limit_summary <- df %>%
  filter(!is.na(DHEA_nmol)) %>%
  group_by(SubjectID) %>%
  summarise(
    total = n(),
    at_limit = sum(DHEA_nmol >= 5.205)
  ) %>%
  filter(at_limit > 1)

#identify specific samples at the ceiling
dhea_at_limit_samples <- df %>%
  filter(DHEA_nmol >= 5.205)

#create cleaned dhea dataframe
#identify subjects with multiple measures at detection limit
dhea_limit_summary <- df %>%
  filter(!is.na(DHEA_nmol)) %>%
  group_by(SubjectID) %>%
  summarise(
    total = n(),
    at_limit = sum(DHEA_nmol >= 5.205)
  ) %>%
  filter(at_limit > 1)

#list subjectids to remove entirely
subjects_to_exclude_dhea <- dhea_limit_summary$SubjectID

#create cleaned dhea dataframe
df_dhea_clean <- df %>%
  #remove subjects with more than 1 limit measurement
  filter(!(SubjectID %in% subjects_to_exclude_dhea)) %>%
  mutate(
    #replace individual limit values with na if subject only had 1
    DHEA_nmol = ifelse(DHEA_nmol >= 5.205, NA, DHEA_nmol),
    #apply log transform to remaining values
    log_DHEA = log(DHEA_nmol)
  ) %>%
  #remove rows that are now na for analysis
  filter(!is.na(log_DHEA))

# Print summary of cleaning actions
print(paste("Number of Samples removed for Cortisol (>80):", sum(df$Cortisol_nmol > 80, na.rm = TRUE)))
print(paste("SubjectID excluded from DHEA df:", 
            paste(subjects_to_exclude_dhea, collapse = ", ")))

view(cort_outliers)
view(dhea_limit_summary)
view(dhea_at_limit_samples)

#cortisol raw vs log
p1 <- ggplot(df_cort_clean, aes(x = Cortisol_nmol)) +
  geom_histogram(fill = "steelblue", bins = 30) +
  labs(title = "raw cortisol")

p2 <- ggplot(df_cort_clean, aes(x = log(Cortisol_nmol))) +
  geom_histogram(fill = "darkblue", bins = 30) +
  labs(title = "log cortisol")

#dhea raw vs log
p3 <- ggplot(df_dhea_clean, aes(x = DHEA_nmol)) +
  geom_histogram(fill = "coral", bins = 30) +
  labs(title = "raw dhea")

p4 <- ggplot(df_dhea_clean, aes(x = log(DHEA_nmol))) +
  geom_histogram(fill = "darkred", bins = 30) +
  labs(title = "log dhea")



library(patchwork)
(p1 + p2) / (p3 + p4)

#make piecewise time variable for cortisol data and DHEA data

#cortisol
df_cort_clean <- df_cort_clean %>%
  mutate(
    #slope 1: slope from time 0 0 to 30 minutes
    time_rise = pmin(MEMs_Min_Since_Wake, 30),
    
    #slope 2: starts at 0, only begins increasing after the 30-min mark.
    time_decline = pmax(0, MEMs_Min_Since_Wake - 30)
  )

#dhea
df_dhea_clean <- df_dhea_clean %>%
  mutate(
    #slope 1
    time_rise = pmin(MEMs_Min_Since_Wake, 30),
    #slope 2
    time_decline = pmax(0, MEMs_Min_Since_Wake - 30)
  )

#piecewise linear mixed models

#cortisol
cort_model <- lmer(log(Cortisol_nmol) ~ time_rise + time_decline + (1 | SubjectID), 
                   data = df_cort_clean)
summary(cort_model)

#DHEA model 
dhea_model <- lmer(log(DHEA_nmol) ~ time_rise + time_decline + (1 | SubjectID), 
                   data = df_dhea_clean)
summary(dhea_model)

#tidy models, include 95% confidence intervals
cort_tidy_ci <- tidy(cort_model, effects = "fixed", conf.int = TRUE, conf.level = 0.95) %>% 
  mutate(Hormone = "Cortisol")

dhea_tidy_ci <- tidy(dhea_model, effects = "fixed", conf.int = TRUE, conf.level = 0.95) %>% 
  mutate(Hormone = "DHEA")

#prepare for display in table
hormone_final_table <- bind_rows(cort_tidy_ci, dhea_tidy_ci) %>%
  mutate(
    term = case_when(
      term == "(Intercept)" ~ "Wake Level (Intercept)",
      term == "time_rise" ~ "Morning Change (0-30 min)",
      term == "time_decline" ~ "Daily Decline (30+ min)"
    ),
    conf_interval = paste0("[", round(conf.low, 4), ", ", round(conf.high, 4), "]"),
    estimate = round(estimate, 4),
    p.value = ifelse(p.value < 0.001, "< 0.001", round(p.value, 3))
  ) %>%
  select(Hormone, term, estimate, conf_interval, p.value)

#make table 
hormone_final_table %>%
  kable(
    col.names = c("Hormone", "Model Parameter", "Estimate (Beta)", "95% CI", "p-value"),
    caption = "Diurnal Hormone Trajectories with 95% Confidence Intervals",
    align = "llccc"
  )

#get predictions for plotting lines
time_seq <- seq(0, 700, length.out = 300)

get_preds <- function(model, times) {
  df_new <- data.frame(
    time_rise = pmin(times, 30),
    time_decline = pmax(0, times - 30)
  )
  df_new$predicted <- predict(model, newdata = df_new, re.form = NA)
  df_new$MEMs_Min_Since_Wake <- times
  return(df_new)
}

cort_line <- get_preds(cort_model, time_seq)
dhea_line <- get_preds(dhea_model, time_seq)



#cortisol plot with overlay
ggplot(df_cort_clean, aes(x = MEMs_Min_Since_Wake, y = log(Cortisol_nmol))) +
  geom_point(alpha = 0.3) +
  geom_line(data = cort_line, aes(y = predicted), color = "blue", size = 1.2) +
  labs(
    title = "MEMs Minutes Since Wake vs Cortisol Levels (nmol)",
    x = "MEM's Minutes Since Wake",
    y = "Cortisol Levels (nmol)")

#dhea plot with overlay
ggplot(df_dhea_clean, aes(x = MEMs_Min_Since_Wake, y = log(DHEA_nmol))) +
  geom_point(alpha = 0.3) +
  geom_line(data = dhea_line, aes(y = predicted), color = "red", size = 1.2) +
  labs(
    title = "MEMs Minutes Since Wake vs DHEA Levels (nmol)",
    x = "MEM's Minutes Since Wake",
    y = "DHEA Levels (nmol)")


```


